# Introduction 
This repository contains scripts to build documentation of Zabbix templates.

This script is tested at Zabbix 6.4, however should also work at other versions. 

## Get all templates in JSON format from Zabbix Server
If the templates not available on the local machine in json format, use the get_templates.sh
to download all templates in json format from the Zabbix server.

Steps:
1. Create a temp folder (for example /tmp/json)
2. Create an API key with at least read rights at all templates
3. execute the script (see ./get_templates.sh -h for help)

## Create the docs
If all templates that needs to be documented are downloaded, run the create_docs.sh script
and point it to the folder where all templates in json format exists. 

`./create_docs.sh /tmp/json/`

This script will itterate over macro's, items, discovery rules, item-, trigger-, and host-discovery rules
and put them in Markdown in an .md file with the name of the template in front of it.

## Notes:
Some things like the output name are hard coded in the template. Feel free to change the complete scipt to your needs.
Not all items will be exported, I have created this script for own purpose and only the items I need myself.

## Example output
___
# Linux by Zabbix agent
## Description
Official Linux template. Requires agent of Zabbix 6.4 or newer.
      
You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/387225-discussion-thread-for-official-zabbix-template-for-linux

Generated by official Zabbix template tool "Templator"
## Macros used
|Name|Description|Default|
|----|-----------|-------|
| {$AGENT.TIMEOUT} | Timeout after which agent is considered unavailable. Works only for agents reachable from Zabbix server/proxy (passive mode). | 3m 
| {$CPU.UTIL.CRIT} |  | 90 
| {$IF.ERRORS.WARN} |  | 2 
| {$IF.UTIL.MAX} | This macro is used as a threshold in the interface utilization trigger. | 90 
| {$IFCONTROL} |  | 1 
| {$KERNEL.MAXFILES.MIN} |  | 256 
| {$KERNEL.MAXPROC.MIN} |  | 1024 
| {$LOAD_AVG_PER_CPU.MAX.WARN} | The CPU load per core is considered sustainable. If necessary, it can be tuned. | 1.5 
| {$MEMORY.AVAILABLE.MIN} | This macro is used as a threshold in the memory available trigger. | 20M 
| {$MEMORY.UTIL.MAX} | This macro is used as a threshold in the memory utilization trigger. | 90 
| {$NET.IF.IFNAME.MATCHES} |  | ^.*$ 
| {$NET.IF.IFNAME.NOT_MATCHES} | It filters out `loopbacks`, `nulls`, `docker veth` links and `docker0 bridge` by default. | (^Software Loopback Interface|^NULL[0-9.]*$|^[Ll]o[0-9.]*$|^[Ss]ystem$|^Nu[0-9.]*$|^veth[0-9A-z]+$|docker[0-9]+|br-[a-z0-9]{12}) 
| {$SWAP.PFREE.MIN.WARN} |  | 50 
| {$SYSTEM.FUZZYTIME.MAX} |  | 60 
| {$VFS.DEV.DEVNAME.MATCHES} | This macro is used for a discovery of block devices. It can be overridden on host level or its linked template level. | .+ 
| {$VFS.DEV.DEVNAME.NOT_MATCHES} | This macro is used for a discovery of block devices. It can be overridden on host level or its linked template level. | ^(loop[0-9]*|sd[a-z][0-9]+|nbd[0-9]+|sr[0-9]+|fd[0-9]+|dm-[0-9]+|ram[0-9]+|ploop[a-z0-9]+|md[0-9]*|hcp[0-9]*|zram[0-9]*) 
| {$VFS.DEV.READ.AWAIT.WARN} | The average response time (in ms) of disk read before the trigger would fire. | 20 
| {$VFS.DEV.WRITE.AWAIT.WARN} | The average response time (in ms) of disk write before the trigger would fire. | 20 
| {$VFS.FS.FREE.MIN.CRIT} | The critical threshold for utilization of the filesystem. | 5G 
| {$VFS.FS.FREE.MIN.WARN} | The warning threshold for utilization of the filesystem. | 10G 
| {$VFS.FS.FSNAME.MATCHES} | This macro is used for discovery of the filesystems. It can be overridden on host level or its linked template level. | .+ 
| {$VFS.FS.FSNAME.NOT_MATCHES} | This macro is used for discovery of the filesystems. It can be overridden on host level or its linked template level. | ^(/dev|/sys|/run|/proc|.+/shm$) 
| {$VFS.FS.FSTYPE.MATCHES} | This macro is used for discovery of the filesystems. It can be overridden on host level or its linked template level. | ^(btrfs|ext2|ext3|ext4|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|apfs|refs|ntfs|fat32|zfs)$ 
| {$VFS.FS.FSTYPE.NOT_MATCHES} | This macro is used for discovery of the filesystems. It can be overridden on host level or its linked template level. | ^\s$ 
| {$VFS.FS.INODE.PFREE.MIN.CRIT} | The critical threshold of the filesystem metadata utilization. | 10 
| {$VFS.FS.INODE.PFREE.MIN.WARN} | The warning threshold of the filesystem metadata utilization. | 20 
| {$VFS.FS.PUSED.MAX.CRIT} | The critical threshold of the filesystem utilization. | 90 
| {$VFS.FS.PUSED.MAX.WARN} | The warning threshold of the filesystem utilization. | 80 
## Items
|Name|Description|Type|Key and additional info|
|----|-----------|----|-----------------------|
| Linux: Host name of Zabbix agent running |   | null | agent.hostname 
| Linux: Zabbix agent ping | The agent always returns 1 for this item. It could be used in combination with nodata() for availability check.  | null | agent.ping 
| Linux: Version of Zabbix agent running |   | null | agent.version 
| Linux: Maximum number of open file descriptors | It could be increased by using `sysctl` utility or modifying the file `/etc/sysctl.conf`.  | null | kernel.maxfiles 
| Linux: Maximum number of processes | It could be increased by using `sysctl` utility or modifying the file `/etc/sysctl.conf`.  | null | kernel.maxproc 
| Linux: Number of processes |   | null | proc.num 
| Linux: Number of running processes |   | null | proc.num[,,run] 
| Linux: System boot time |   | null | system.boottime 
| Linux: Interrupts per second |   | null | system.cpu.intr 
| Linux: Load average (1m avg) |   | null | system.cpu.load[all,avg1] 
| Linux: Load average (5m avg) |   | null | system.cpu.load[all,avg5] 
| Linux: Load average (15m avg) |   | null | system.cpu.load[all,avg15] 
| Linux: Number of CPUs |   | null | system.cpu.num 
| Linux: Context switches per second |   | null | system.cpu.switches 
| Linux: CPU utilization | The CPU utilization expressed in %.  | DEPENDENT | system.cpu.util 
| Linux: CPU guest time | Guest time - the time spent on running a virtual CPU for a guest operating system.  | null | system.cpu.util[,guest] 
| Linux: CPU guest nice time | The time spent on running a niced guest (a virtual CPU for guest operating systems under the control of the Linux kernel).  | null | system.cpu.util[,guest_nice] 
| Linux: CPU idle time | The time the CPU has spent doing nothing.  | null | system.cpu.util[,idle] 
| Linux: CPU interrupt time | The amount of time the CPU has been servicing hardware interrupts.  | null | system.cpu.util[,interrupt] 
| Linux: CPU iowait time | The amount of time the CPU has been waiting for I/O to complete.  | null | system.cpu.util[,iowait] 
| Linux: CPU nice time | The time the CPU has spent running users' processes that have been niced.  | null | system.cpu.util[,nice] 
| Linux: CPU softirq time | The amount of time the CPU has been servicing software interrupts.  | null | system.cpu.util[,softirq] 
| Linux: CPU steal time | The amount of "stolen" CPU from this virtual machine by the hypervisor for other tasks, such as running another virtual machine.  | null | system.cpu.util[,steal] 
| Linux: CPU system time | The time the CPU has spent running the kernel and its processes.  | null | system.cpu.util[,system] 
| Linux: CPU user time | The time the CPU has spent running users' processes that are not niced.  | null | system.cpu.util[,user] 
| Linux: System name | The host name of the system.  | null | system.hostname 
| Linux: System local time | The local system time of the host.  | null | system.localtime 
| Linux: Operating system architecture | The architecture of the operating system.  | null | system.sw.arch 
| Linux: Operating system |   | null | system.sw.os 
| Linux: Number of installed packages |   | null | system.sw.packages.get 
| Linux: Free swap space | The free space of the swap volume/file expressed in bytes.  | null | system.swap.size[,free] 
| Linux: Free swap space in % | The free space of the swap volume/file expressed in %.  | null | system.swap.size[,pfree] 
| Linux: Total swap space | The total space of the swap volume/file expressed in bytes.  | null | system.swap.size[,total] 
| Linux: System description | The information as normally returned by `uname -a`.  | null | system.uname 
| Linux: System uptime | The system uptime expressed in the following format: "N days, hh:mm:ss".  | null | system.uptime 
| Linux: Number of logged in users | The number of users who are currently logged in.  | null | system.users.num 
| Linux: Checksum of /etc/passwd |   | null | vfs.file.cksum[/etc/passwd,sha256] 
| Linux: Get filesystems | The `vfs.fs.get` key acquires raw information set about the file systems. Later to be extracted by preprocessing in dependent items.  | null | vfs.fs.get 
| Linux: Available memory | The available memory: - in Linux - available = free + buffers + cache; - on other platforms calculation may vary.  See also Appendixes in Zabbix Documentation about parameters of the `vm.memory.size` item.  | null | vm.memory.size[available] 
| Linux: Available memory in % | The available memory as percentage of the total. See also Appendixes in Zabbix Documentation about parameters of the `vm.memory.size` item.  | null | vm.memory.size[pavailable] 
| Linux: Total memory | The total memory expressed in bytes.  | null | vm.memory.size[total] 
| Linux: Memory utilization | The percentage of used memory is calculated as `100-pavailable`.  | DEPENDENT | vm.memory.utilization 
| Linux: Zabbix agent availability | Monitoring the availability status of the agent.  | INTERNAL | zabbix[host,agent,available] 
## Triggers
|Name|Description|Expression|Severity|Dependencies and additional info|
|----|-----------|----------|--------|--------------------------------|
| Linux: Configured max number of open filedescriptors is too low | null  | last(/Linux by Zabbix agent/kernel.maxfiles)<{$KERNEL.MAXFILES.MIN} | INFO |  |
| Linux: Configured max number of processes is too low | null  | last(/Linux by Zabbix agent/kernel.maxproc)<{$KERNEL.MAXPROC.MIN} | INFO | **Depends on**: Linux: Getting closer to process limit |
| Linux: High CPU utilization | The CPU utilization is too high. The system might be slow to respond.  | min(/Linux by Zabbix agent/system.cpu.util,5m)>{$CPU.UTIL.CRIT} | WARNING | **Depends on**: Linux: Load average is too high |
| Linux: System name has changed | The name of the system has changed. Acknowledge to close the problem manually.  | change(/Linux by Zabbix agent/system.hostname) and length(last(/Linux by Zabbix agent/system.hostname))>0 | INFO | **Depends on**: Linux: Load average is too high |
| Linux: System time is out of sync | The host's system time is different from Zabbix server time.  | fuzzytime(/Linux by Zabbix agent/system.localtime,{$SYSTEM.FUZZYTIME.MAX})=0 | WARNING | **Depends on**: Linux: Load average is too high |
| Linux: Operating system description has changed | The description of the operating system has changed. Possible reasons are that the system has been updated or replaced. Acknowledge to close the problem manually.  | change(/Linux by Zabbix agent/system.sw.os) and length(last(/Linux by Zabbix agent/system.sw.os))>0 | INFO | **Depends on**: Linux: System name has changed |
| Linux: Number of installed packages has been changed | null  | change(/Linux by Zabbix agent/system.sw.packages.get)<>0 | WARNING | **Depends on**: Linux: System name has changed |
| Linux: {HOST.NAME} has been restarted | The host uptime is less than 10 minutes.  | last(/Linux by Zabbix agent/system.uptime)<10m | WARNING | **Depends on**: Linux: System name has changed |
| Linux: /etc/passwd has been changed | null  | last(/Linux by Zabbix agent/vfs.file.cksum[/etc/passwd,sha256],#1)<>last(/Linux by Zabbix agent/vfs.file.cksum[/etc/passwd,sha256],#2) | INFO | **Depends on**: Linux: Operating system description has changed |
| Linux: High memory utilization | The system is running out of free memory.  | min(/Linux by Zabbix agent/vm.memory.utilization,5m)>{$MEMORY.UTIL.MAX} | AVERAGE | **Depends on**: Linux: Lack of available memory |
| Linux: Zabbix agent is not available | For passive only agents, host availability is used with {$AGENT.TIMEOUT} as time threshold.  | max(/Linux by Zabbix agent/zabbix[host,agent,available],{$AGENT.TIMEOUT})=0 | AVERAGE | **Depends on**: Linux: Lack of available memory |
## LLD rule Network interface discovery
|Name|Description|Type|Key|
|----|-----------|----|---|
| Network interface discovery | The discovery of network interfaces. | null | net.if.discovery 
### Item prototypes for Network interface discovery
|Name|Description|Type|Key|
|----|-----------|----|---|
| Interface {#IFNAME}: Inbound packets discarded |   | null | net.if.in["{#IFNAME}",dropped] 
| Interface {#IFNAME}: Inbound packets with errors |   | null | net.if.in["{#IFNAME}",errors] 
| Interface {#IFNAME}: Bits received |   | null | net.if.in["{#IFNAME}"] 
| Interface {#IFNAME}: Outbound packets discarded |   | null | net.if.out["{#IFNAME}",dropped] 
| Interface {#IFNAME}: Outbound packets with errors |   | null | net.if.out["{#IFNAME}",errors] 
| Interface {#IFNAME}: Bits sent |   | null | net.if.out["{#IFNAME}"] 
| Interface {#IFNAME}: Operational status | Reference: https://www.kernel.org/doc/Documentation/networking/operstates.txt  | null | vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"] 
| Interface {#IFNAME}: Speed | It indicates the latest or current speed value of the interface. The value is an integer representing the link speed expressed in bits/sec. This attribute is only valid for the interfaces that implement the ethtool `get_link_ksettings` method (mostly Ethernet).  Reference: https://www.kernel.org/doc/Documentation/ABI/testing/sysfs-class-net  | null | vfs.file.contents["/sys/class/net/{#IFNAME}/speed"] 
| Interface {#IFNAME}: Interface type | It indicates the interface protocol type as a decimal value. See `include/uapi/linux/if_arp.h` for all possible values. Reference: https://www.kernel.org/doc/Documentation/ABI/testing/sysfs-class-net  | null | vfs.file.contents["/sys/class/net/{#IFNAME}/type"] 
### Trigger prototypes for Network interface discovery
|Name|Description|Espression|Severity|Dependencies|
|----|-----------|----------|--------|------------|
| Interface {#IFNAME}: Link down | This trigger expression works as follows: 1. It can be triggered if the operations status is down. 2. `{$IFCONTROL:"{#IFNAME}"}=1` - a user can redefine context macro to value - 0. That marks this interface as not important. No new trigger will be fired if this interface is down. 3. `{TEMPLATE_NAME:METRIC.diff()}=1` - the trigger fires only if the operational status was up to (1) sometime before (so, do not fire for the 'eternal off' interfaces.)  WARNING: if closed manually - it will not fire again on the next poll, because of .diff.  | {$IFCONTROL:"{#IFNAME}"}=1 and last(/Linux by Zabbix agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"])=2 and (last(/Linux by Zabbix agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#1)<>last(/Linux by Zabbix agent/vfs.file.contents["/sys/class/net/{#IFNAME}/operstate"],#2)) | AVERAGE |  
## LLD rule Block devices discovery
|Name|Description|Type|Key|
|----|-----------|----|---|
| Block devices discovery |  | null | vfs.dev.discovery 
### Item prototypes for Block devices discovery
|Name|Description|Type|Key|
|----|-----------|----|---|
| {#DEVNAME}: Disk average queue size (avgqu-sz) | The current average disk queue; the number of requests outstanding on the disk while the performance data is being collected.  | DEPENDENT | vfs.dev.queue_size[{#DEVNAME}] 
| {#DEVNAME}: Disk read request avg waiting time (r_await) | This formula contains two Boolean expressions that evaluate to 1 or 0 in order to set the calculated metric to zero and to avoid the exception - division by zero.  | CALCULATED | vfs.dev.read.await[{#DEVNAME}] 
| {#DEVNAME}: Disk read rate | r/s (read operations per second) - the number (after merges) of read requests completed per second for the device.  | DEPENDENT | vfs.dev.read.rate[{#DEVNAME}] 
| {#DEVNAME}: Disk read time (rate) | The rate of total read time counter; used in `r_await` calculation.  | DEPENDENT | vfs.dev.read.time.rate[{#DEVNAME}] 
| {#DEVNAME}: Disk utilization | This item is the percentage of elapsed time during which the selected disk drive was busy while servicing read or write requests.  | DEPENDENT | vfs.dev.util[{#DEVNAME}] 
| {#DEVNAME}: Disk write request avg waiting time (w_await) | This formula contains two Boolean expressions that evaluate to 1 or 0 in order to set the calculated metric to zero and to avoid the exception - division by zero.  | CALCULATED | vfs.dev.write.await[{#DEVNAME}] 
| {#DEVNAME}: Disk write rate | w/s (write operations per second) - the number (after merges) of write requests completed per second for the device.  | DEPENDENT | vfs.dev.write.rate[{#DEVNAME}] 
| {#DEVNAME}: Disk write time (rate) | The rate of total write time counter; used in `w_await` calculation.  | DEPENDENT | vfs.dev.write.time.rate[{#DEVNAME}] 
| {#DEVNAME}: Get stats | The contents of get `/sys/block/{#DEVNAME}/stat` to get the disk statistics.  | null | vfs.file.contents[/sys/block/{#DEVNAME}/stat] 
## LLD rule Mounted filesystem discovery
|Name|Description|Type|Key|
|----|-----------|----|---|
| Mounted filesystem discovery | The discovery of mounted filesystems with different types. | DEPENDENT | vfs.fs.dependent.discovery 
### Item prototypes for Mounted filesystem discovery
|Name|Description|Type|Key|
|----|-----------|----|---|
| {#FSNAME}: Free inodes in % |   | DEPENDENT | vfs.fs.dependent.inode[{#FSNAME},pfree] 
| {#FSNAME}: Space utilization | Space utilization expressed in % for `{#FSNAME}`.  | DEPENDENT | vfs.fs.dependent.size[{#FSNAME},pused] 
| {#FSNAME}: Total space | The total space expressed in bytes.  | DEPENDENT | vfs.fs.dependent.size[{#FSNAME},total] 
| {#FSNAME}: Used space | Used storage expressed in bytes.  | DEPENDENT | vfs.fs.dependent.size[{#FSNAME},used] 
| {#FSNAME}: Get filesystem data |   | DEPENDENT | vfs.fs.dependent[{#FSNAME},data] 
| {#FSNAME}: Filesystem is read-only | The filesystem is mounted as read-only. It is available only for Zabbix agents 6.4 and higher.  | DEPENDENT | vfs.fs.dependent[{#FSNAME},readonly] 
### Trigger prototypes for Mounted filesystem discovery
|Name|Description|Espression|Severity|Dependencies|
|----|-----------|----------|--------|------------|
| {#FSNAME}: Running out of free inodes | It may become impossible to write to a disk if there are no index nodes left. The following error messages may be returned as symptoms, even though the free space is available: - 'No space left on device'; - 'Disk is full'.  | min(/Linux by Zabbix agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"} | AVERAGE |  
| {#FSNAME}: Running out of free inodes | It may become impossible to write to a disk if there are no index nodes left. The following error messages may be returned as symptoms, even though the free space is available: - 'No space left on device'; - 'Disk is full'.  | min(/Linux by Zabbix agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"} | WARNING | **Depends on**: {#FSNAME}: Running out of free inodes 
| {#FSNAME}: Filesystem has become read-only | The filesystem has become read-only. A possible reason is an I/O error. It is available only for Zabbix agents 6.4 and higher.  | last(/Linux by Zabbix agent/vfs.fs.dependent[{#FSNAME},readonly],#2)=0 and last(/Linux by Zabbix agent/vfs.fs.dependent[{#FSNAME},readonly])=1 | AVERAGE |  
### Stats
Macros: 28
Items: 43
Triggers: 11
LLD Rules: 3
Item prototypes: 24
Trigger prototypes: 4
Host prototypes: 0
Document created at 22-03-2024
[Template Documebt Builder by Zablove](https://github.com/Zablove)
